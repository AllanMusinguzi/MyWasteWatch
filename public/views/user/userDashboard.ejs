<%- include("../common/head.ejs") %>  
<%- include("../common/navigation/navUser.ejs") %>

<link rel="stylesheet" href="/css/styles.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>

<aside class="logo-sidebar" aria-label="Sidebar">
  <div class="h-full px-3 pb-4 overflow-y-auto">
    <ul class="space-y-2 font-medium">
      <li>
        <a href="/home" class="sidebar-link">
          <i class="fas fa-home"></i> <!-- Font Awesome Home Icon -->
          <span class="flex-1 ms-3">Dashboard</span>
        </a>
      </li>
      <li>
        <a href="/my-requests" class="sidebar-link">
          <i class="fas fa-tasks"></i> <!-- Font Awesome Tasks Icon -->
          <span class="flex-1 ms-3">All Requests</span>
        </a>
      </li>
      <li>
        <a href="/raise-a-request" class="sidebar-link">
          <i class="fas fa-plus-circle"></i> <!-- Font Awesome Plus Circle Icon -->
          <span class="flex-1 ms-3">Create Request</span>
        </a>
      </li>
    </ul>
  </div>
</aside>

<div class="p-4 sm:ml-64">
  <div class="p-4 mt-40 mb-0">
    <div class="container max-w-9xl mx-auto p-6 bg-white rounded-xl shadow-md">      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-xl shadow">
          <h2 class="text-5xl text-center mb-4">Total Requests Overview</h2>
          <div class="grid grid-cols-2 gap-4">
            <div class="p-4 bg-blue-100 rounded-xl text-center">
              <div class="font-bold text-5xl text-blue-800"><%= result.total_requests %></div>
              <div class="mt-2 text-2xl text-blue-600">Total Requests</div>
            </div>
            <div class="p-4 bg-green-100 rounded-xl text-center">
              <div class="font-bold text-5xl text-green-800"><%= result.total_resolved %></div>
              <div class="mt-2 text-2xl text-green-600">Completed Requests</div>
            </div>
            <div class="p-4 bg-yellow-100 rounded-xl text-center">
              <div class="font-bold text-5xl text-yellow-800"><%= result.total_pending %></div>
              <div class="mt-2 text-2xl text-yellow-600">Pending Requests</div>
            </div>
            <div class="p-4 bg-purple-100 rounded-xl text-center">
              <div class="font-bold text-5xl text-purple-800"><%= result.total_unassigned_driver_requests %></div>
              <div class="mt-2 text-2xl text-purple-600">Unassigned Drivers</div>
            </div>
          </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
          <h2 class="text-xl font-bold mb-4">Request Types Distribution</h2>
          <canvas id="requestTypesChart"></canvas>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
          <h2 class="text-xl font-bold mb-4">Request Status</h2>
          <canvas id="requestStatusChart"></canvas>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
          <h2 class="text-xl font-bold mb-4">Request Types</h2>
          <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg">
              <span class="font-semibold">Pickup requests</span>
              <span class="text-lg font-bold"><%= result.total_pickup_request %></span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg">
              <span class="font-semibold">Complaint requests</span>
              <span class="text-lg font-bold"><%= result.total_complaint_request %></span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg">
              <span class="font-semibold">Recycling requests</span>
              <span class="text-lg font-bold"><%= result.total_recycling_request %></span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg">
              <span class="font-semibold">Other requests</span>
              <span class="text-lg font-bold"><%= result.total_other_request %></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Request Types Distribution Chart
  const requestTypesCtx = document.getElementById('requestTypesChart').getContext('2d');
  new Chart(requestTypesCtx, {
    type: 'pie',
    data: {
      labels: ['Pickup', 'Complaint', 'Recycling', 'Others'],
      datasets: [{
        data: [
          <%= result.total_pickup_request %>,
          <%= result.total_complaint_request %>,
          <%= result.total_recycling_request %>,
          <%= result.total_other_request %>
        ],
        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: 'Request Types Distribution'
        }
      }
    }
  });

  // Request Status Chart
  const requestStatusCtx = document.getElementById('requestStatusChart').getContext('2d');
  new Chart(requestStatusCtx, {
    type: 'bar',
    data: {
      labels: ['Pending', 'Completed', 'Unassigned'],
      datasets: [{
        label: 'Number of Requests',
        data: [
          <%= result.total_pending %>,
          <%= result.total_resolved %>,
          <%= result.total_unassigned_driver_requests %>
        ],
        backgroundColor: ['#FFCE56', '#4BC0C0', '#FF6384']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false,
        },
        title: {
          display: true,
          text: 'Request Status'
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>