<%- include("../common/head.ejs") %>
<%- include("../common/nav.ejs") %>

<link rel="stylesheet" href="/css/styles.css">
<script src="/js/admin.js" defer></script>

<style>
  .modal {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent background */
    transition: all 0.3s ease;
  }

  .modal-content {
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    position: relative;
    width: 400px; /* Set a width for the modal */
  }

  .close-btn {
    position: absolute;
    right: 10px;
    top: 10px;
    cursor: pointer;
    font-size: 20px;
  }

  .hidden {
    display: none;
  }

  /* Pagination styles */
  .pagination-nav {
    display: flex;
    justify-content: center;
    margin-top: 20px;
  }

  .pagination {
    list-style: none;
    display: flex;
    gap: 5px;
  }

  .pagination li {
    padding: 5px 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .pagination li.active {
    background-color: #006400; /* Updated active pagination color */
    color: white;
  }

  .pagination a {
    text-decoration: none;
    color: black;
  }

  .pagination a:hover {
    color: #006400; /* Updated hover color */
  }
</style>

<!--Toggle Button-->
<button id="toggle-btn" class="btn btn-success d-md-none mt-3 ms-3" style="z-index: 1000;">Toggle Sidebar</button>

<aside id="logo-sidebar" class="fixed top-0 left-0 z-40 w-64 pt-20 transition-transform -translate-x-full sm:translate-x-0" aria-label="Sidebar">
  <div class="h-full px-3 pb-4 overflow-y-auto">
    <ul class="space-y-2 font-medium">
      <li>
        <a href="dashboard" class="sidebar-link"><svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 21"><path d="M16.975 11H10V4.025a1 1 0 0 0-1.066-.998 8.5 8.5 0 1 0 9.039 9.039.999.999 0 0 0-1-1.066h.002Z" /><path d="M12.5 0c-.157 0-.311.01-.565.027A1 1 0 0 0 11 1.02V10h8.975a1 1 0 0 0 1-.935c.013-.188.028-.374.028-.565A8.51 8.51 0 0 0 12.5 0Z" /></svg><span class="ms-3 text-xl">Dashboard</span></a>
      </li>
      <li>
        <a href="/admin/allRequests" class="sidebar-link"><svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 18"><path d="M6.143 0H1.857A1.857 1.857 0 0 0 0 1.857v4.286C0 7.169.831 8 1.857 8h4.286A1.857 1.857 0 0 0 8 6.143V1.857A1.857 1.857 0 0 0 6.143 0Zm10 0h-4.286A1.857 1.857 0 0 0 10 1.857v4.286C10 7.169 10.831 8 11.857 8h4.286A1.857 1.857 0 0 0 18 6.143V1.857A1.857 1.857 0 0 0 16.143 0Zm-10 10H1.857A1.857 1.857 0 0 0 0 11.857v4.286C0 17.169.831 18 1.857 18h4.286A1.857 1.857 0 0 0 8 16.143v-4.286A1.857 1.857 0 0 0 6.143 10Zm10 0h-4.286A1.857 1.857 0 0 0 10 11.857v4.286c0 1.026.831 1.857 1.857 1.857h4.286A1.857 1.857 0 0 0 18 16.143v-4.286A1.857 1.857 0 0 0 16.143 10Z" /></svg><span class="ms-3 text-xl whitespace-nowrap">Requests</span></a>
      </li>
      <li>
        <a href="/admin/createDriver" class="sidebar-link"><svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="m17.418 3.623-.018-.008a6.713 6.713 0 0 0-2.4-.569V2h1a1 1 0 1 0 0-2h-2a1 1 0 0 0-1 1v2H9.89A6.977 6.977 0 0 1 12 8v5h-2V8A5 5 0 1 0 0 8v6a1 1 0 0 0 1 1h8v4a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-4h6a1 1 0 0 0 1-1V8a5 5 0 0 0-2.582-4.377ZM6 12H4a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2Z" /></svg><span class="flex-1 ms-3 text-xl whitespace-nowrap"> Create Driver</span></a>
      </li>
      <li>
        <a href="/admin/allDrivers" class="sidebar-link"><svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20"><path d="M17 5.923A1 1 0 0 0 16 5h-3V4a4 4 0 1 0-8 0v1H2a1 1 0 0 0-1 .923L.086 17.846A2 2 0 0 0 2.08 20h13.84a2 2 0 0 0 1.994-2.153L17 5.923ZM7 9a1 1 0 0 1-2 0V7h2v2Zm0-5a2 2 0 1 1 4 0v1H7V4Zm6 5a1 1 0 1 1-2 0V7h2v2Z" /></svg><span class="flex-1 ms-3 text-xl whitespace-nowrap">Drivers</span></a>
      </li>
      <li>
        <a href="/admin/allUsers" class="sidebar-link"><svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20"><path d="M17 5.923A1 1 0 0 0 16 5h-3V4a4 4 0 1 0-8 0v1H2a1 1 0 0 0-1 .923L.086 17.846A2 2 0 0 0 2.08 20h13.84a2 2 0 0 0 1.994-2.153L17 5.923ZM7 9a1 1 0 0 1-2 0V7h2v2Zm0-5a2 2 0 1 1 4 0v1H7V4Zm6 5a1 1 0 1 1-2 0V7h2v2Z" /></svg><span class="flex-1 ms-3 text-xl whitespace-nowrap">Users</span></a>
      </li>
    </ul>
  </div>
</aside>

<main class="ml-64 p-4">
  <div class="flex justify-between">
    <h2 class="text-2xl font-bold">User Management</h2>
    <button id="addUserBtn" class="btn btn-primary">Add User</button>
  </div>

  <table class="table-auto w-full mt-4">
    <thead>
      <tr>
        <th class="px-4 py-2">Full Name</th>
        <th class="px-4 py-2">Contact</th>
        <th class="px-4 py-2">Email</th>
        <th class="px-4 py-2">Address</th>
        <th class="px-4 py-2">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% users.forEach(user => { %>
      <tr>
        <td class="border px-4 py-2"><%= user.fullName %></td>
        <td class="border px-4 py-2"><%= user.contact %></td>
        <td class="border px-4 py-2"><%= user.email %></td>
        <td class="border px-4 py-2"><%= user.address %></td>
        <td class="border px-4 py-2">
          <a href="/admin/editUser/<%= user.id %>" class="btn btn-warning">Edit</a>
          <button class="btn btn-danger" onclick="deleteUser('<%= user.id %>')">Delete</button>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="pagination-nav">
    <ul class="pagination">
      <% if (currentPage > 1) { %>
        <li><a href="/admin/allUsers?page=<%= currentPage - 1 %>">Previous</a></li>
      <% } %>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="<%= currentPage === i ? 'active' : '' %>">
          <a href="/admin/allUsers?page=<%= i %>"><%= i %></a>
        </li>
      <% } %>
      <% if (currentPage < totalPages) { %>
        <li><a href="/admin/allUsers?page=<%= currentPage + 1 %>">Next</a></li>
      <% } %>
    </ul>
  </div>

  <!-- Add User Modal -->
  <div id="addUserModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>
      <h3>Add New User</h3>
      <form id="addUserForm">
        <div>
          <label for="name">Full Name:</label>
          <input type="text" id="name" name="name" required>
        </div>
        <div>
          <label for="number">Contact:</label>
          <input type="text" id="number" name="number" required>
        </div>
        <div>
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div>
          <label for="address">Address:</label>
          <input type="text" id="address" name="address" required>
        </div>
        <button type="submit" class="btn btn-primary">Add User</button>
      </form>
    </div>
  </div>

</main>

<script>
  document.getElementById('addUserBtn').addEventListener('click', function() {
    document.getElementById('addUserModal').classList.remove('hidden');
  });

  document.getElementById('closeModal').addEventListener('click', function() {
    document.getElementById('addUserModal').classList.add('hidden');
  });

  document.getElementById('addUserForm').addEventListener('submit', function(event) {
    event.preventDefault();
    // AJAX or fetch code here to send form data to the server
    const formData = new FormData(this);
    fetch('/admin/addUser', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('User added successfully');
        location.reload(); // Reload the page to see the new user
      } else {
        alert('Error adding user: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });

  function deleteUser(userId) {
    if (confirm('Are you sure you want to delete this user?')) {
      fetch(`/admin/deleteUser/${userId}`, { method: 'DELETE' })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('User deleted successfully');
          location.reload(); // Reload the page to see the updated user list
        } else {
          alert('Error deleting user: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }
  }
</script>

<%- include("../common/footer.ejs") %>
