<%- include("../common/head.ejs") %>
<%- include("../common/nav.ejs") %>

<link rel="stylesheet" href="/css/styles.css">
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  .dashboard-card {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin-bottom: 20px;
  }
  .stat-card {
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
  }
  .stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #006400;
  }
  .stat-label {
    font-size: 14px;
    font-family: 'Ubuntu', sans-serif;
    color: #000;
  }
</style>

<!--Toggle Button-->
<button id="toggle-btn" class="btn btn-primary d-md-none mt-3 ms-3" style="z-index: 1000;">
  <i class="fas fa-bars"></i>
</button>

<aside id="logo-sidebar" class="fixed top-0 left-0 z-40 w-64 pt-20 transition-transform -translate-x-full sm:translate-x-0" aria-label="Sidebar">
  <div class="h-full px-3 pb-4 overflow-y-auto">
    <ul class="space-y-2 font-medium">
      <li>
        <a href="dashboard" class="sidebar-link">
          <svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2L2 9h3v7h10V9h3L10 2z" />
          </svg>
          <span class="ms-3 text-xl">Dashboard</span>
        </a>
      </li>
      <li>
        <a href="/admin/allRequests" class="sidebar-link">
          <svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M1 3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3z" />
          </svg>
          <span class="ms-3 text-xl whitespace-nowrap">Requests</span>
        </a>
      </li>
      <li>
        <a href="/admin/createDriver" class="sidebar-link">
          <svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a8 8 0 0 0-8 8h2a6 6 0 1 1 12 0h2a8 8 0 0 0-8-8zM4 16h12v2H4v-2z" />
          </svg>
          <span class="flex-1 ms-3 text-xl whitespace-nowrap">Create Driver</span>
        </a>
      </li>
      <li>
        <a href="/admin/allDrivers" class="sidebar-link">
          <svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a8 8 0 0 0-8 8h2a6 6 0 1 1 12 0h2a8 8 0 0 0-8-8zM4 16h12v2H4v-2z" />
          </svg>
          <span class="flex-1 ms-3 text-xl whitespace-nowrap">Drivers</span>
        </a>
      </li>
      <li>
        <a href="/admin/allUsers" class="sidebar-link">
          <svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 10a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm-6 6a6 6 0 0 1 12 0H4z" />
          </svg>
          <span class="flex-1 ms-3 text-xl whitespace-nowrap">Users</span>
        </a>
      </li>
      <li>
        <a href="/admin/logout" class="sidebar-link">
          <svg class="svg-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 16">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 8h11m0 0L8 4m4 4-4 4m4-11h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-3" />
          </svg>
          <span class="flex-1 ms-3 text-xl whitespace-nowrap">Logout</span>
        </a>
      </li>
    </ul>
  </div>
</aside>

<div class="p-4 sm:ml-64">
  <div class="p-4 border-2 border-gray-200 border-dashed rounded-lg dark:border-gray-700 mt-14">
    <h1 class="text-3xl font-bold mb-6" style="text-align: center;">Admin Dashboard</h1>
    
    <!-- Overview Statistics -->
    <div class="dashboard-card">
      <h2 class="text-xl font-semibold mb-4">Overview</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="stat-card">
          <div class="stat-value"><%= result.total_requests %></div>
          <div class="stat-label">Total Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-value"><%= result.total_drivers %></div>
          <div class="stat-label">Total Drivers</div>
        </div>
        <div class="stat-card">
          <div class="stat-value"><%= result.total_users %></div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-value"><%= result.total_trucks + result.total_cars + result.total_van + result.total_motorcycle %></div>
          <div class="stat-label">Total Vehicles</div>
        </div>
      </div>
    </div>
    
    <!-- Request Statistics -->
    <div class="dashboard-card">
      <h2 class="text-xl font-semibold mb-4">Request Statistics</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <canvas id="requestStatusChart"></canvas>
        </div>
        <div>
          <canvas id="requestTypesChart"></canvas>
        </div>
      </div>
    </div>
    
    <!-- Vehicle Statistics -->
    <div class="dashboard-card">
      <h2 class="text-xl font-semibold mb-4">Vehicle Statistics</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <canvas id="vehicleTypesChart"></canvas>
        </div>
        <div>
          <table class="min-w-full bg-white">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Vehicle Type</th>
                <th class="py-2 px-4 border-b">Count</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="py-2 px-4 border-b">Trucks</td>
                <td class="py-2 px-4 border-b"><%= result.total_trucks %></td>
              </tr>
              <tr>
                <td class="py-2 px-4 border-b">Cars</td>
                <td class="py-2 px-4 border-b"><%= result.total_cars %></td>
              </tr>
              <tr>
                <td class="py-2 px-4 border-b">Vans</td>
                <td class="py-2 px-4 border-b"><%= result.total_van %></td>
              </tr>
              <tr>
                <td class="py-2 px-4 border-b">Motorcycles</td>
                <td class="py-2 px-4 border-b"><%= result.total_motorcycle %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Toggle sidebar functionality
  const toggleBtn = document.getElementById('toggle-btn');
  const sidebar = document.getElementById('logo-sidebar');

  toggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('-translate-x-full');
  });

  // Chart.js configurations
  const requestStatusData = {
    labels: ['Pending', 'Completed', 'Unassigned'],
    datasets: [{
      data: [<%= result.total_pending %>, <%= result.total_resolved %>, <%= result.total_unassigned_driver_requests %>],
      backgroundColor: ['#ffc107', '#28a745', '#17a2b8']
    }]
  };

  const requestTypesData = {
    labels: ['Pickup', 'Complaint', 'Recycling', 'Others'],
    datasets: [{
      data: [<%= result.total_pickup_request %>, <%= result.total_complaint_request %>, <%= result.total_recycling_request %>, <%= result.total_other_request %>],
      backgroundColor: ['#007bff', '#dc3545', '#20c997', '#6c757d']
    }]
  };

  const vehicleTypesData = {
    labels: ['Trucks', 'Cars', 'Vans', 'Motorcycles'],
    datasets: [{
      data: [<%= result.total_trucks %>, <%= result.total_cars %>, <%= result.total_van %>, <%= result.total_motorcycle %>],
      backgroundColor: ['#fd7e14', '#6f42c1', '#e83e8c', '#1e90ff']
    }]
  };

  // Create charts
  new Chart(document.getElementById('requestStatusChart'), {
    type: 'pie',
    data: requestStatusData,
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: 'Request Status'
        }
      }
    }
  });

  new Chart(document.getElementById('requestTypesChart'), {
    type: 'doughnut',
    data: requestTypesData,
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: 'Request Types'
        }
      }
    }
  });

  new Chart(document.getElementById('vehicleTypesChart'), {
    type: 'bar',
    data: {
      labels: vehicleTypesData.labels,
      datasets: [{
        label: 'Number of Vehicles',
        data: vehicleTypesData.datasets[0].data,
        backgroundColor: vehicleTypesData.datasets[0].backgroundColor
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false,
        },
        title: {
          display: true,
          text: 'Vehicle Types Distribution'
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>